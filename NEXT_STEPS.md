# 次の実装ステップ

現在、MVP（最小実装）は完了し、モックデータでの動作確認ができています。

## 🎯 現在の実装状況

### ✅ 完了している機能

1. **基本機能**

   - ✅ 商品検索（キーワード検索）
   - ✅ 価格比較画面
   - ✅ 価格更新ジョブ実行
   - ✅ 送料計算（テーブル方式）

2. **プロバイダ**

   - ✅ demo プロバイダ（モックデータ） - **動作確認済み**
   - ✅ public_html プロバイダ（サンプル HTML から抽出） - 実装済み、未テスト

3. **インフラ**
   - ✅ Docker Compose 環境
   - ✅ データベースマイグレーション
   - ✅ Redis + Asynq ジョブキュー

---

## 📋 次の実装ステップ（優先順位順）

### Phase 1: 基本機能の完成（すぐに実装可能）

#### 1. public_html プロバイダのテスト

- [ ] `/admin/jobs` で "public_html" を選択して実行
- [ ] サンプル HTML から正しくデータが抽出されるか確認
- [ ] 検索結果に表示されるか確認

**作業時間**: 10-15 分（テストのみ）

#### 2. エラーハンドリングの改善

- [ ] 検索結果が空の場合のメッセージ改善
- [ ] ネットワークエラーの詳細表示
- [ ] ジョブ実行時のエラーログ表示

**作業時間**: 1-2 時間

---

### Phase 2: 本番環境向け機能（コンプライアンス対応）

#### 3. robots.txt チェック機能

- [ ] robots.txt パーサーの実装
- [ ] 各プロバイダでアクセス前にチェック
- [ ] 許可されていないパスのスキップ

**重要度**: ⚠️ 高（本番前に必須）
**作業時間**: 4-6 時間

#### 4. レートリミットの実装

- [ ] プロバイダごとのレートリミット設定
- [ ] バックオフ戦略の実装（指数バックオフ）
- [ ] リクエスト間隔の制御

**重要度**: ⚠️ 高（本番前に必須）
**作業時間**: 3-4 時間

#### 5. 監査ログ

- [ ] すべてのリクエストをログに記録
- [ ] アクセスした URL、時刻、User-Agent を記録
- [ ] コンプライアンス監査用のログ形式

**重要度**: ⚠️ 高（本番前に必須）
**作業時間**: 2-3 時間

---

### Phase 3: 機能拡張

#### 6. 画像検索の実装

- [ ] 画像アップロード機能（フロントエンド）
- [ ] 画像認識 API 連携（Google Vision API 等）
- [ ] 画像から商品を検索する機能

**重要度**: 中
**作業時間**: 8-12 時間

#### 7. 公式 API プロバイダの追加

- [ ] Amazon Product Advertising API 連携
- [ ] その他の EC サイト API 連携
- [ ] API 認証の実装

**重要度**: 高（推奨：スクレイピングより安全）
**作業時間**: 8-16 時間（API による）

---

### Phase 4: パフォーマンス・品質向上

#### 8. キャッシュ戦略の改善

- [ ] Redis キャッシュの実装
- [ ] キャッシュの TTL 設定
- [ ] キャッシュ無効化戦略

**作業時間**: 4-6 時間

#### 9. テストの追加

- [ ] 統合テスト
- [ ] E2E テスト（Playwright 等）
- [ ] パフォーマンステスト

**作業時間**: 8-12 時間

#### 10. CI/CD パイプライン

- [ ] GitHub Actions 等の設定
- [ ] 自動テスト実行
- [ ] 自動デプロイ

**作業時間**: 4-6 時間

---

## 🚀 推奨される次のアクション

### すぐにできること（今日中）

1. **public_html プロバイダのテスト**

   ```bash
   # 1. 管理画面で "public_html" を選択して実行
   # 2. サンプルHTMLからデータが抽出されるか確認
   # 3. 検索で結果が表示されるか確認
   ```

2. **エラーメッセージの改善**
   - より分かりやすいエラーメッセージを表示
   - ユーザーに次のアクションを案内

### 今週中に実装したいこと

3. **robots.txt チェック機能**

   - 本番環境で使用する前に必須

4. **レートリミットの実装**
   - サーバーへの負荷を抑えるため重要

### 将来的に実装したいこと

5. **公式 API プロバイダの追加**

   - より安全で確実なデータ取得方法

6. **画像検索**
   - ユーザー体験の向上

---

## 💡 実装のヒント

### robots.txt チェックの実装例

```go
// internal/providers/robots.go
type RobotsChecker struct {
    cache map[string]*robots.RobotsData
}

func (r *RobotsChecker) CanFetch(url, userAgent string) (bool, error) {
    // robots.txtを取得してチェック
    // キャッシュを活用
}
```

### レートリミットの実装例

```go
// internal/ratelimit/limiter.go
type Limiter struct {
    limiters map[string]*rate.Limiter
}

func (l *Limiter) Wait(ctx context.Context, key string) error {
    // レートリミットに達するまで待機
    // バックオフ戦略を実装
}
```

---

## 📝 注意事項

1. **コンプライアンス**: 実際のサイトにアクセスする前に、必ず利用規約を確認してください
2. **テスト**: 本番環境にデプロイする前に、十分なテストを実施してください
3. **監視**: 本番環境では、すべてのリクエストを監視・記録してください
