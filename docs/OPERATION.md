# 運用ガイド

## 価格更新ジョブの実行

### 管理画面から実行

1. `http://localhost:3000/admin/jobs` にアクセス
2. プロバイダを選択（Walmart / Amazon / All）
3. 「価格更新ジョブを実行」ボタンをクリック
4. ジョブIDが表示されたら、バックグラウンドで処理が開始されます

### 実行可能なプロバイダ

- **Walmart**: Walmart公式APIを使用（`WALMART_API_KEY`が必要）
- **Amazon**: Amazon Product Advertising APIを使用（`AMAZON_ACCESS_KEY`, `AMAZON_SECRET_KEY`, `AMAZON_ASSOCIATE_TAG`が必要）
- **All**: 有効化されているすべてのプロバイダを順次実行

### ジョブの確認

- ジョブは非同期で実行されます
- 実行状況はログで確認できます
- 完了後、`/search` で商品を検索して結果を確認できます

## 商品検索

### キーワード検索

1. `http://localhost:3000/search` にアクセス
2. 検索キーワードを入力（商品名、型番、JAN等）
3. 検索結果から商品を選択
4. `/compare` 画面で価格比較

### 検索対象

- 商品名（タイトル）
- ブランド名
- モデル名
- 商品識別子（JAN/UPC/EAN/MPN/ASIN等）

## 価格比較

### 比較画面の機能

1. **総額が安い順**: 合計金額（商品価格 + 送料 + 手数料）でソート
2. **納期が早い順**: 推定到着日数でソート（min_days優先）
3. **更新日時が新しい順**: 価格更新日時でソート
4. **在庫あり優先**: 在庫ありのオファーを優先表示

### 表示される情報

- 商品価格
- 送料
- 手数料
- 税（取得できた場合）
- 合計金額
- 推定到着日数（min-max日）
- 在庫ステータス
- 更新日時
- 商品ページURL

## データ更新頻度

- 価格情報は手動でジョブを実行するまで更新されません
- 定期的に更新する場合は、cronジョブ等で自動実行を設定してください
- 更新頻度は各APIの利用規約に従ってください

## コンプライアンス

### 公式APIの使用

- WalmartとAmazonの公式APIを使用しているため、robots.txtチェックは不要です
- ただし、レートリミット、監査ログ、リトライ機能は引き続き適用されます

### データ取得の制限

- 取得対象は公式API経由の公開情報のみです
- ログインが必要なページ、購入フロー、個人情報にはアクセスしません
- 監査ログにすべてのAPIリクエストが記録されます

### 利用規約の遵守

- 各APIの利用規約を確認し、遵守してください
- レートリミットを超えないよう注意してください
- 取得したデータの使用目的を確認してください

## トラブルシューティング

### ジョブが実行されない

- プロバイダが有効化されているか確認
- APIキーが正しく設定されているか確認
- ログを確認してエラーメッセージを確認

### 商品が検索できない

- 価格更新ジョブを実行してデータを取得しているか確認
- 検索キーワードが適切か確認
- データベースに商品が存在するか確認

### 価格が表示されない

- オファーが取得されているか確認
- 価格更新ジョブを再実行
- ログを確認してエラーメッセージを確認

## ログの確認

### Docker Composeの場合

```bash
# APIサーバーのログを確認
docker logs pricecompare-api -f

# 特定のプロバイダのログを確認
docker logs pricecompare-api -f | grep "walmart"
docker logs pricecompare-api -f | grep "amazon"
```

### 監査ログの確認

```bash
# HTTPリクエストの監査ログを確認
docker logs pricecompare-api -f | grep "HTTP request audit"
```



